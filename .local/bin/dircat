#!/bin/sh
# vim: ft=sh

# Function to dump file contents
dump_file() {
	filepath="$1"

	echo "#####################################"
	echo "filename: $filepath"
	echo ""

	if [ -f "$filepath" ]; then
		if ! cat "$filepath" 2>/dev/null; then
			echo "[Error reading file: $filepath]"
		fi
	else
		echo "[Skipping: $filepath is not a regular file]"
	fi
}

# Function to process paths recursively
process_path() {
	path="$1"

	if [ -f "$path" ]; then
		dump_file "$path"
	elif [ -d "$path" ]; then
		find "$path" -type f | while IFS= read -r file; do
			dump_file "$file"
		done
	else
		echo "[Skipping: $path is not a file or directory]"
	fi
}

# Main Logic
if [ $# -lt 1 ]; then
	echo "Usage: $0 <file_or_directory> [more ...]"
	exit 1
fi

# Run the processing and capture all output into a variable
# We then pipe that variable to wl-copy
# Using a subshell () to group all output from the loop
(
	for path in "$@"; do
		process_path "$path"
	done
) | wl-copy

echo "Successfully copied file contents to clipboard."
